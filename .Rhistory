alpha0 ~ dnorm(0.0, 1.0)
beta0 ~ dnorm(0.0, 1.0)
alpha1 ~ dnorm(0.0, 1.0)
alpha2[1] <- 0
alpha2[2] ~ dnorm(0.0, 1.0)
alpha3[1] <- 0
alpha3[2] ~ dnorm(0.0, 1.0)
alpha3[3] ~ dnorm(0.0, 1.0)
alpha3[4] ~ dnorm(0.0, 1.0)
alpha4[1] <- 0
alpha4[2] ~ dnorm(0.0, 1.0)
alpha4[3] ~ dnorm(0.0, 1.0)
beta1[1] <- 0
beta1[2] ~ dnorm(0.0, 1.0)
beta2[1] <- 0
beta2[2] ~ dnorm(0.0, 1.0)
beta2[3] ~ dnorm(0.0, 1.0)
beta2[4] ~ dnorm(0.0, 1.0)
}
"
fit2 <- jags.model(textConnection(modelo2), data, inits, n.chains = 2)
update(fit2, 2000)
set.seed(1)
sample2 <- coda.samples(fit2, param, n.iter = 2500, thin = 1)
plot(sample2)
summary(sample2)
######## como Viene en el libro (Creo que no convergen )
modelo2 = "model{
for(i in 1:n){
y[i] ~ dpois(mu[i])
mu[i] <- (u[i] + 0.00000001)*lambda[i]
u[i] ~ dbern(p[i])
logit(p[i]) <- alpha0 + alpha1*X1[i] + alpha2[X2[i]] + alpha3[X3[i]] + alpha4[X4[i]]
log(lambda[i]) <- beta0 + beta1[X5[i]] + beta2[X3[i]]
zdp[i] <- (1 - p[i]) + p[i]*exp(-lambda[i])}
#### Priors
alpha0 ~ dnorm(0.0, 0.0001)
beta0 ~ dnorm(0.0, 0.0001)
alpha1 ~ dnorm(0.0, 0.0001)
alpha2[1] <- 0
alpha2[2] ~ dnorm(0.0, 0.0001)
alpha3[1] <- 0
alpha3[2] ~ dnorm(0.0, 0.0001)
alpha3[3] ~ dnorm(0.0, 0.0001)
alpha3[4] ~ dnorm(0.0, 0.0001)
alpha4[1] <- 0
alpha4[2] ~ dnorm(0.0, 0.0001)
alpha4[3] ~ dnorm(0.0, 0.0001)
beta1[1] <- 0
beta1[2] ~ dnorm(0.0, 0.0001)
beta2[1] <- 0
beta2[2] ~ dnorm(0.0, 0.0001)
beta2[3] ~ dnorm(0.0, 0.0001)
beta2[4] ~ dnorm(0.0, 0.0001)
}
"
fit2 <- jags.model(textConnection(modelo2), data, inits, n.chains = 2)
update(fit2, 2000)
set.seed(1)
sample2 <- coda.samples(fit2, param, n.iter = 2500, thin = 1)
plot(sample2)
summary(sample2)
fit2 <- jags.model(textConnection(modelo2), data, inits, n.chains = 2)
update(fit2, 5000)
set.seed(1)
sample2 <- coda.samples(fit2, param, n.iter = 5000, thin = 1)
plot(sample2)
summary(sample2)
log(Edad)
#### JAGS
attach(CData_CDMX2)
data <- list(
y = Vic_Rob_As,
X1 = log(Edad),
X2 = Mas_Pat_Vil,
X3 = as.numeric(Region),
X4 = as.numeric(Sit_Lab),
X5 = Seg_Mun,
n =length(Vic_Rob_As)
)
param <- c("alpha0", "alpha1", "alpha2", "alpha3", "alpha4", "beta0", "beta1", "beta2")
inits <- function(){ list(
"alpha0" = rnorm(1),
"alpha1" = rnorm(1),
"beta0" = rnorm(1)
)
}
###### Con este sí convergen, pero difieren mucho los frecuentistas con el Bayesiano
modelo1 = "model{
for(i in 1:n){
y[i] ~ dpois(mu[i])
mu[i] <- (1-u[i]+0.0000001)*lambda[i]
u[i] ~ dbern(p[i])
logit(p[i]) <- alpha0 + alpha1*X1[i] + alpha2[X2[i]] + alpha3[X3[i]] + alpha4[X4[i]]
log(lambda[i]) <- beta0 + beta1[X5[i]] + beta2[X3[i]]
zdp[i] <- p[i] + (1-p[i])*exp(-lambda[i])}
#### Priors
alpha0 ~ dnorm(0.0, 0.0001)
beta0 ~ dnorm(0.0, 0.0001)
alpha1 ~ dnorm(0.0, 0.0001)
alpha2[1] <- 0
alpha2[2] ~ dnorm(0.0, 0.0001)
alpha3[1] <- 0
alpha3[2] ~ dnorm(0.0, 0.0001)
alpha3[3] ~ dnorm(0.0, 0.0001)
alpha3[4] ~ dnorm(0.0, 0.0001)
alpha4[1] <- 0
alpha4[2] ~ dnorm(0.0, 0.0001)
alpha4[3] ~ dnorm(0.0, 0.0001)
beta1[1] <- 0
beta1[2] ~ dnorm(0.0, 0.0001)
beta2[1] <- 0
beta2[2] ~ dnorm(0.0, 0.0001)
beta2[3] ~ dnorm(0.0, 0.0001)
beta2[4] ~ dnorm(0.0, 0.0001)
}
"
fit1 <- jags.model(textConnection(modelo1), data, inits, n.chains = 2)
update(fit1, 5000)
set.seed(1)
sample2 <- coda.samples(fit2, param, n.iter = 5000, thin = 1)
plot(sample2)
summary(sample2)
library(rjags)
library(tidyverse)
library(ROCR)
library(pROC)
library(car)
load("BD_CDMX2.Rda")
##Creamos base con respuesta 1 y 0
CData_CDMX3 <- CData_CDMX2 %>%
mutate(Vic_Rob_As = ifelse(Vic_Rob_As>0,1,0))
CData_CDMX3$Vic_Rob_As <- as_factor(CData_CDMX3$Vic_Rob_As)
load("sampleCC.Rdata")
setwd("C:/Users/edson/Documents/Bayes_Proyect/BayesProject")
load("sampleCC.Rdata")
setwd("C:/Users/edson/Documents/BayesProject")
load("sampleCC.Rdata")
plot(sample)
ssample <- summary(sample)
betas <- ssample[[1]][,1]
Ejemplo2_1 <- CData_CDMX4 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==0, S==0, N==0, O ==0)
Ejemplo4_1 <- CData_CDMX4 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==1, S==0, N==0, O ==0)
Ejemplo6_1 <- CData_CDMX4 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==0, S==0, N==1, O ==0)
Ejemplo8_1 <- CData_CDMX4 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==1, S==0, N==1, O ==0)
Ejemplo9_1 <- CData_CDMX4 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==0, NoMas ==0, S==1, N==0, O ==0)
Ejemplo10_1 <- CData_CDMX4 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==0, S==1, N==0, O ==0)
Ejemplo12_1 <- CData_CDMX4 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==1, S==1, N==0, O ==0)
Ejemplo14_1 <- CData_CDMX4 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==0, S==0, N==0, O ==1)
Ejemplo16_1 <- CData_CDMX4 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==1, S==0, N==0, O ==1)
##Obtenemos los valores ajustados de nuestra probabilidad
Tabla1 <- rbind(Ejemplo2_1[1,],Ejemplo4_1[1,],Ejemplo6_1[1,],Ejemplo8_1[1,],Ejemplo9_1[1,],Ejemplo10_1[1,],Ejemplo12_1[1,],Ejemplo14_1[1,],
Ejemplo16_1[1,])
p_i1 <- rep(0,9)
for(i in 1:9){
exponente <- sum(betas1 * Tabla[i,])
p_i1[i] <- 1/(1+exp(-exponente))
}
set.seed(17)
##Realizamos nuestra simulación
Sim1 <- rbinom(9,n_i,p_i1)
##Graficamos los simulados y los reales.
Reales <- c(rep(0,20),rep(1,7))
Simu1 <- c(27-sum(Sim1),sum(Sim1))
ggplot() +
geom_histogram(aes(x=Reales),binwidth = 1, col = "black", fill = "#25B7BC") +
geom_point(aes(x=c(0,1) , y=Simu), col = "#B225BC", size = 2.8) + geom_point(aes(x=c(0,1),y=Simu1), col ="#2528BC",size=2.8) +
theme_light() + ylab("Casos") + xlab("Robo (1) o No (0)")
##Comparamos lo obtenido del clásico al bayesiano
fittedfrec <- modlog2$fitted.values
#Conseguimos nuestras probas para cada individuo
fitted <- rep(0,5417)
for(i in 1:5417){
expo <- sum(betas*CData_CDMX4[i,])
p <- 1/(1+exp(-expo))
fitted[i] <- p
}
#Obtenemos el error entre ambas
error <- (fitted - fittedfrec)^2
sum(error)
#### Modelo Bayesiano Resultados:
predictions <- prediction(fitted,CData_CDMX3$Vic_Rob_As)
plot(unlist(performance(predictions, "sens")@x.values), unlist(performance(predictions, "sens")@y.values),
type="l", lwd=2, ylab="Sensitivity", xlab="Punto de Corte")
par(new=TRUE)
plot(unlist(performance(predictions, "spec")@x.values), unlist(performance(predictions, "spec")@y.values),
type="l", lwd=2, col='red', ylab="", xlab="")
rest <- abs(unlist(performance(predictions, "sens")@y.values)-unlist(performance(predictions, "spec")@y.values))
opt <- unlist(performance(predictions, "sens")@x.values)[which(rest==min(rest))]
r <- ifelse(fitted>=opt,1,0)
table(r,CData_CDMX3$Vic_Rob_As) ##61.86%
predictions <- prediction(fitted,CData_CDMX3$Vic_Rob_As)
plot(unlist(performance(predictions, "sens")@x.values), unlist(performance(predictions, "sens")@y.values),
type="l", lwd=2, ylab="Sensitivity", xlab="Punto de Corte")
par(new=TRUE)
plot(unlist(performance(predictions, "spec")@x.values), unlist(performance(predictions, "spec")@y.values),
type="l", lwd=2, col='red', ylab="", xlab="")
rest <- abs(unlist(performance(predictions, "sens")@y.values)-unlist(performance(predictions, "spec")@y.values))
opt <- unlist(performance(predictions, "sens")@x.values)[which(rest==min(rest))]
r <- ifelse(fitted>=opt,1,0)
table(r,CData_CDMX3$Vic_Rob_As) ##61.86%
predictions <- prediction(fitted,CData_CDMX3$Vic_Rob_As)
load("C:/Users/edson/Documents/BayesProject/BD_CDMX2.Rda")
CData_CDMX3 <- CData_CDMX2 %>%
mutate(Vic_Rob_As = ifelse(Vic_Rob_As>0,1,0))
CData_CDMX3$Vic_Rob_As <- as_factor(CData_CDMX3$Vic_Rob_As)
predictions <- prediction(fitted,CData_CDMX3$Vic_Rob_As)
plot(unlist(performance(predictions, "sens")@x.values), unlist(performance(predictions, "sens")@y.values),
type="l", lwd=2, ylab="Sensitivity", xlab="Punto de Corte")
par(new=TRUE)
plot(unlist(performance(predictions, "spec")@x.values), unlist(performance(predictions, "spec")@y.values),
type="l", lwd=2, col='red', ylab="", xlab="")
rest <- abs(unlist(performance(predictions, "sens")@y.values)-unlist(performance(predictions, "spec")@y.values))
opt <- unlist(performance(predictions, "sens")@x.values)[which(rest==min(rest))]
r <- ifelse(fitted>=opt,1,0)
table(r,CData_CDMX3$Vic_Rob_As) ##61.86%
load("sampleCC.Rdata")
plot(sample)
ssample <- summary(sample)
betas <- ssample[[1]][,1]
fitted <- rep(0,5417)
for(i in 1:5417){
expo <- sum(betas*CData_CDMX4[i,])
p <- 1/(1+exp(-expo))
fitted[i] <- p
}
betas1<-smod2$coefficients[,1]
CData_CDMX4 <- CData_CDMX3 %>%
mutate(Empleado = ifelse(Sit_Lab == "Empleado",1,0), SinOcup = ifelse(Sit_Lab == "Sin Ocupación",1,0),
EstDom = ifelse(Sit_Lab == "Estudiantes y Domésticos",1,0), CP = ifelse(Region == "Centro Poniente",1,0),
S = ifelse(Region == "Sur",1,0), N = ifelse(Region == "Norte",1,0), O = ifelse(Region == "Oriente",1,0),
NB = ifelse(Nivel_Edu == "No Básica",1,0), Sec =ifelse(Nivel_Edu == "Secundaria",1,0),
MS = ifelse(Nivel_Edu == "Medio Superior",1,0), Sup = ifelse(Nivel_Edu == "Superior",1,0),
Pos = ifelse(Nivel_Edu == "Posgrado",1,0), Seg = ifelse(Seg_Mun == 1,1,0), NoSeg = ifelse(Seg_Mun ==2,1,0),
Mas = ifelse(Mas_Pat_Vil == 1,1,0), NoMas = ifelse(Mas_Pat_Vil == 2,1,0), Alpha = 1) %>%
select(Alpha, Edad, Empleado, SinOcup, EstDom, Seg, NoSeg, Mas, NoMas, NB, Sec, MS, Sup, Pos, CP, S, N, O)
CData_CDMX6 <- CData_CDMX4 %>%
select(-Empleado,-Seg,-Mas,-NB,-CP)
Ejemplo2_1 <- CData_CDMX6 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==0, S==0, N==0, O ==0)
Ejemplo4_1 <- CData_CDMX6 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==1, S==0, N==0, O ==0)
Ejemplo6_1 <- CData_CDMX6 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==0, S==0, N==1, O ==0)
Ejemplo8_1 <- CData_CDMX6 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==1, S==0, N==1, O ==0)
Ejemplo9_1 <- CData_CDMX6 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==0, NoMas ==0, S==1, N==0, O ==0)
Ejemplo10_1 <- CData_CDMX6 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==0, S==1, N==0, O ==0)
Ejemplo12_1 <- CData_CDMX6 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==1, S==1, N==0, O ==0)
Ejemplo14_1 <- CData_CDMX6 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==0, S==0, N==0, O ==1)
Ejemplo16_1 <- CData_CDMX6 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==1, S==0, N==0, O ==1)
##Ejemplo
Ejemplo2 <- CData_CDMX3 %>%
filter(Edad == 22, Seg_Mun == 2, Mas_Pat_Vil == 1, Region == "Centro Poniente", Nivel_Edu == "Superior",Sit_Lab == "Estudiantes y Domésticos")
Ejemplo4 <- CData_CDMX3 %>%
filter(Edad == 22, Seg_Mun == 2, Mas_Pat_Vil == 2, Region == "Centro Poniente", Nivel_Edu == "Superior",Sit_Lab == "Estudiantes y Domésticos")
Ejemplo6 <- CData_CDMX3 %>%
filter(Edad == 22, Seg_Mun == 2, Mas_Pat_Vil == 1, Region == "Norte", Nivel_Edu == "Superior",Sit_Lab == "Estudiantes y Domésticos")
Ejemplo8 <- CData_CDMX3 %>%
filter(Edad == 22, Seg_Mun == 2, Mas_Pat_Vil == 2, Region == "Norte", Nivel_Edu == "Superior",Sit_Lab == "Estudiantes y Domésticos")
Ejemplo9 <- CData_CDMX3 %>%
filter(Edad == 22, Seg_Mun == 1, Mas_Pat_Vil == 1, Region == "Sur", Nivel_Edu == "Superior",Sit_Lab == "Estudiantes y Domésticos")
Ejemplo10 <- CData_CDMX3 %>%
filter(Edad == 22, Seg_Mun == 2, Mas_Pat_Vil == 1, Region == "Sur", Nivel_Edu == "Superior",Sit_Lab == "Estudiantes y Domésticos")
Ejemplo12 <- CData_CDMX3 %>%
filter(Edad == 22, Seg_Mun == 2, Mas_Pat_Vil == 2, Region == "Sur", Nivel_Edu == "Superior",Sit_Lab == "Estudiantes y Domésticos")
Ejemplo14 <- CData_CDMX3 %>%
filter(Edad == 22, Seg_Mun == 2, Mas_Pat_Vil == 1, Region == "Oriente", Nivel_Edu == "Superior",Sit_Lab == "Estudiantes y Domésticos")
Ejemplo16 <- CData_CDMX3 %>%
filter(Edad == 22, Seg_Mun == 2, Mas_Pat_Vil == 2, Region == "Oriente", Nivel_Edu == "Superior",Sit_Lab == "Estudiantes y Domésticos")
##Obtenemos los valores ajustados de nuestra probabilidad
Tabla <- rbind(Ejemplo2_1[1,],Ejemplo4_1[1,],Ejemplo6_1[1,],Ejemplo8_1[1,],Ejemplo9_1[1,],Ejemplo10_1[1,],Ejemplo12_1[1,],Ejemplo14_1[1,],
Ejemplo16_1[1,])
p_i <- rep(0,9)
for(i in 1:9){
exponente <- sum(betas1 * Tabla[i,])
p_i[i] <- 1/(1+exp(-exponente))
}
##Realizamos nuestra simulación
n_i <-c(1,3,3,5,2,6,1,5,1)
Sim <- rbinom(9,n_i,p_i)
##Graficamos los simulados y los reales.
Reales <- c(rep(0,20),rep(1,7))
Simu <- c(27-sum(Sim),sum(Sim))
ggplot() +
geom_histogram(aes(x=Reales),binwidth = 1, col = "red", fill = "orange") + geom_point(aes(x=c(0,1) , y=Simu))
##Preparamos datos para ejemplos
betas1<-smod2$coefficients[,1]
modlog2 <- glm(Vic_Rob_As ~ Edad + Sit_Lab + Seg_Mun + Mas_Pat_Vil + Nivel_Edu + Region, family = "binomial",data=CData_CDMX3)
smod2 <- summary(modlog2)
betas1<-smod2$coefficients[,1]
CData_CDMX4 <- CData_CDMX3 %>%
mutate(Empleado = ifelse(Sit_Lab == "Empleado",1,0), SinOcup = ifelse(Sit_Lab == "Sin Ocupación",1,0),
EstDom = ifelse(Sit_Lab == "Estudiantes y Domésticos",1,0), CP = ifelse(Region == "Centro Poniente",1,0),
S = ifelse(Region == "Sur",1,0), N = ifelse(Region == "Norte",1,0), O = ifelse(Region == "Oriente",1,0),
NB = ifelse(Nivel_Edu == "No Básica",1,0), Sec =ifelse(Nivel_Edu == "Secundaria",1,0),
MS = ifelse(Nivel_Edu == "Medio Superior",1,0), Sup = ifelse(Nivel_Edu == "Superior",1,0),
Pos = ifelse(Nivel_Edu == "Posgrado",1,0), Seg = ifelse(Seg_Mun == 1,1,0), NoSeg = ifelse(Seg_Mun ==2,1,0),
Mas = ifelse(Mas_Pat_Vil == 1,1,0), NoMas = ifelse(Mas_Pat_Vil == 2,1,0), Alpha = 1) %>%
select(Alpha, Edad, Empleado, SinOcup, EstDom, Seg, NoSeg, Mas, NoMas, NB, Sec, MS, Sup, Pos, CP, S, N, O)
CData_CDMX6 <- CData_CDMX4 %>%
select(-Empleado,-Seg,-Mas,-NB,-CP)
Ejemplo2_1 <- CData_CDMX6 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==0, S==0, N==0, O ==0)
Ejemplo4_1 <- CData_CDMX6 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==1, S==0, N==0, O ==0)
Ejemplo6_1 <- CData_CDMX6 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==0, S==0, N==1, O ==0)
Ejemplo8_1 <- CData_CDMX6 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==1, S==0, N==1, O ==0)
Ejemplo9_1 <- CData_CDMX6 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==0, NoMas ==0, S==1, N==0, O ==0)
Ejemplo10_1 <- CData_CDMX6 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==0, S==1, N==0, O ==0)
Ejemplo12_1 <- CData_CDMX6 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==1, S==1, N==0, O ==0)
Ejemplo14_1 <- CData_CDMX6 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==0, S==0, N==0, O ==1)
Ejemplo16_1 <- CData_CDMX6 %>%
filter(Edad == 22, EstDom == 1, Sup == 1, NoSeg ==1, NoMas ==1, S==0, N==0, O ==1)
##Ejemplo
Ejemplo2 <- CData_CDMX3 %>%
filter(Edad == 22, Seg_Mun == 2, Mas_Pat_Vil == 1, Region == "Centro Poniente", Nivel_Edu == "Superior",Sit_Lab == "Estudiantes y Domésticos")
Ejemplo4 <- CData_CDMX3 %>%
filter(Edad == 22, Seg_Mun == 2, Mas_Pat_Vil == 2, Region == "Centro Poniente", Nivel_Edu == "Superior",Sit_Lab == "Estudiantes y Domésticos")
Ejemplo6 <- CData_CDMX3 %>%
filter(Edad == 22, Seg_Mun == 2, Mas_Pat_Vil == 1, Region == "Norte", Nivel_Edu == "Superior",Sit_Lab == "Estudiantes y Domésticos")
Ejemplo8 <- CData_CDMX3 %>%
filter(Edad == 22, Seg_Mun == 2, Mas_Pat_Vil == 2, Region == "Norte", Nivel_Edu == "Superior",Sit_Lab == "Estudiantes y Domésticos")
Ejemplo9 <- CData_CDMX3 %>%
filter(Edad == 22, Seg_Mun == 1, Mas_Pat_Vil == 1, Region == "Sur", Nivel_Edu == "Superior",Sit_Lab == "Estudiantes y Domésticos")
Ejemplo10 <- CData_CDMX3 %>%
filter(Edad == 22, Seg_Mun == 2, Mas_Pat_Vil == 1, Region == "Sur", Nivel_Edu == "Superior",Sit_Lab == "Estudiantes y Domésticos")
Ejemplo12 <- CData_CDMX3 %>%
filter(Edad == 22, Seg_Mun == 2, Mas_Pat_Vil == 2, Region == "Sur", Nivel_Edu == "Superior",Sit_Lab == "Estudiantes y Domésticos")
Ejemplo14 <- CData_CDMX3 %>%
filter(Edad == 22, Seg_Mun == 2, Mas_Pat_Vil == 1, Region == "Oriente", Nivel_Edu == "Superior",Sit_Lab == "Estudiantes y Domésticos")
Ejemplo16 <- CData_CDMX3 %>%
filter(Edad == 22, Seg_Mun == 2, Mas_Pat_Vil == 2, Region == "Oriente", Nivel_Edu == "Superior",Sit_Lab == "Estudiantes y Domésticos")
##Obtenemos los valores ajustados de nuestra probabilidad
Tabla <- rbind(Ejemplo2_1[1,],Ejemplo4_1[1,],Ejemplo6_1[1,],Ejemplo8_1[1,],Ejemplo9_1[1,],Ejemplo10_1[1,],Ejemplo12_1[1,],Ejemplo14_1[1,],
Ejemplo16_1[1,])
p_i <- rep(0,9)
for(i in 1:9){
exponente <- sum(betas1 * Tabla[i,])
p_i[i] <- 1/(1+exp(-exponente))
}
##Realizamos nuestra simulación
n_i <-c(1,3,3,5,2,6,1,5,1)
Sim <- rbinom(9,n_i,p_i)
##Graficamos los simulados y los reales.
Reales <- c(rep(0,20),rep(1,7))
Simu <- c(27-sum(Sim),sum(Sim))
ggplot() +
geom_histogram(aes(x=Reales),binwidth = 1, col = "red", fill = "orange") + geom_point(aes(x=c(0,1) , y=Simu))
Tabla1 <- rbind(Ejemplo2_1[1,],Ejemplo4_1[1,],Ejemplo6_1[1,],Ejemplo8_1[1,],Ejemplo9_1[1,],Ejemplo10_1[1,],Ejemplo12_1[1,],Ejemplo14_1[1,],
Ejemplo16_1[1,])
p_i1 <- rep(0,9)
for(i in 1:9){
exponente <- sum(betas1 * Tabla[i,])
p_i1[i] <- 1/(1+exp(-exponente))
}
set.seed(17)
##Realizamos nuestra simulación
Sim1 <- rbinom(9,n_i,p_i1)
##Graficamos los simulados y los reales.
Reales <- c(rep(0,20),rep(1,7))
Simu1 <- c(27-sum(Sim1),sum(Sim1))
ggplot() +
geom_histogram(aes(x=Reales),binwidth = 1, col = "black", fill = "#25B7BC") +
geom_point(aes(x=c(0,1) , y=Simu), col = "#B225BC", size = 2.8) + geom_point(aes(x=c(0,1),y=Simu1), col ="#2528BC",size=2.8) +
theme_light() + ylab("Casos") + xlab("Robo (1) o No (0)")
fitted <- rep(0,5417)
for(i in 1:5417){
expo <- sum(betas*CData_CDMX4[i,])
p <- 1/(1+exp(-expo))
fitted[i] <- p
}
#Obtenemos el error entre ambas
error <- (fitted - fittedfrec)^2
sum(error)
#### Modelo Bayesiano Resultados:
predictions <- prediction(fitted,CData_CDMX3$Vic_Rob_As)
plot(unlist(performance(predictions, "sens")@x.values), unlist(performance(predictions, "sens")@y.values),
type="l", lwd=2, ylab="Sensitivity", xlab="Punto de Corte")
par(new=TRUE)
plot(unlist(performance(predictions, "spec")@x.values), unlist(performance(predictions, "spec")@y.values),
type="l", lwd=2, col='red', ylab="", xlab="")
rest <- abs(unlist(performance(predictions, "sens")@y.values)-unlist(performance(predictions, "spec")@y.values))
opt <- unlist(performance(predictions, "sens")@x.values)[which(rest==min(rest))]
r <- ifelse(fitted>=opt,1,0)
table(r,CData_CDMX3$Vic_Rob_As) ##61.86%
set.seed(3)
vec2 <- rbinom(length(fitted),1,fitted)
table(vec2,CData_CDMX3$Vic_Rob_As) ###70.24%
set.seed(3)
vec2 <- rbinom(length(modlog2$fitted.values),1,modlog2$fitted.values)
table(vec2,CData_CDMX3$Vic_Rob_As)
vec2 <- rbinom(length(fitted),1,fitted)
table(vec2,CData_CDMX3$Vic_Rob_As) ###70.24%
library(tidyverse)
library(ggplot2)
as_tibble(xtabs(~ Vic_Rob_As + Sit_Lab , data = CData_CDMX3_1))  %>% ggplot() +
geom_bar(aes(x=Vic_Rob_As, y = n, fill = Sit_Lab), stat = "identity", color = "black", position = position_dodge()) +
xlab("Víctima de Robo/Asalto") + ylab("Personas") + labs(fill = "Alcaldía Segura") + theme_bw()
CData_CDMX3_1 <- CData_CDMX3 %>%
mutate(Vic_Rob_As = as_factor(ifelse(Vic_Rob_As == 1,"Sí", "No")),
Seg_Mun = as_factor(ifelse(Seg_Mun == 1,"Sí", "No")),
Imp_Seg = as_factor(ifelse(Imp_Seg == 1, "Sí", "No")),
Mas_Pat_Vil = as_factor(ifelse(Mas_Pat_Vil == 1, "Sí","No")))
CData_CDMX2_1 <- CData_CDMX2 %>%
mutate(Seg_Mun = as_factor(ifelse(Seg_Mun == 1,"Sí", "No")),
Imp_Seg = as_factor(ifelse(Imp_Seg == 1, "Sí", "No")),
Mas_Pat_Vil = as_factor(ifelse(Mas_Pat_Vil == 1, "Sí","No")))
as_tibble(xtabs(~ Vic_Rob_As + Sit_Lab , data = CData_CDMX3_1))  %>% ggplot() +
geom_bar(aes(x=Vic_Rob_As, y = n, fill = Sit_Lab), stat = "identity", color = "black", position = position_dodge()) +
xlab("Víctima de Robo/Asalto") + ylab("Personas") + labs(fill = "Alcaldía Segura") + theme_bw()
as_tibble(xtabs(~ Vic_Rob_As + Sit_Lab , data = CData_CDMX3_1))  %>% ggplot() +
geom_bar(aes(x=Vic_Rob_As, y = n, fill = Sit_Lab), stat = "identity", color = "black", position = position_dodge()) +
xlab("Víctima de Robo/Asalto") + ylab("Personas") + labs(fill = "Alcaldía Segura") + theme_bw() + scale_fill_manual(values = pal)
pal <- c("#00B8C2", "#C862C9", "#62C3C9", "#62C96B", "#BCC962")
as_tibble(xtabs(~ Vic_Rob_As + Sit_Lab , data = CData_CDMX3_1))  %>% ggplot() +
geom_bar(aes(x=Vic_Rob_As, y = n, fill = Sit_Lab), stat = "identity", color = "black", position = position_dodge()) +
xlab("Víctima de Robo/Asalto") + ylab("Personas") + labs(fill = "Alcaldía Segura") + theme_bw() + scale_fill_manual(values = pal)
as_tibble(xtabs(~ Vic_Rob_As + Sit_Lab , data = CData_CDMX3_1))  %>% ggplot() +
geom_bar(aes(x=Vic_Rob_As, y = n, fill = Sit_Lab), stat = "identity", color = "black", position = position_dodge()) +
xlab("Víctima de Robo/Asalto") + ylab("Personas") + labs(fill = "Situación Laboral") + theme_bw() + scale_fill_manual(values = pal)
as_tibble(xtabs(~ Vic_Rob_As + Sit_Lab , data = CData_CDMX3_1))  %>% ggplot() +
geom_bar(aes(x=Vic_Rob_As, y = n, fill = Sit_Lab), stat = "identity", color = "black", position = position_dodge()) +
xlab("Número de Robos/ Asaltos") + ylab("Personas") + labs(fill = "Situación Laboral") + theme_bw() + scale_fill_manual(values = pal)
as_tibble(xtabs(~ Vic_Rob_As + Sit_Lab , data = CData_CDMX3_1))  %>% ggplot() +
geom_bar(aes(x=Vic_Rob_As, y = n, fill = Sit_Lab), stat = "identity", color = "black", position = position_dodge()) +
xlab("Víctima de Robo/Asalto") + ylab("Personas") + labs(fill = "Situación Laboral") + theme_bw() + scale_fill_manual(values = pal)
as_tibble(xtabs(~ Vic_Rob_As + Sit_Lab , data = CData_CDMX3_1))  %>% ggplot() +
geom_bar(aes(x=Vic_Rob_As, y = n, fill = Sit_Lab), stat = "identity", color = "black", position = position_dodge()) +
xlab("Número de Robos/ Asaltos") + ylab("Personas") + labs(fill = "Situación Laboral") + theme_bw() + scale_fill_manual(values = pal)
as_tibble(xtabs(~ Vic_Rob_As + Sit_Lab , data = CData_CDMX3_1))  %>% ggplot() +
geom_bar(aes(x=Vic_Rob_As, y = n, fill = Sit_Lab), stat = "identity", color = "black", position = position_dodge()) +
xlab("Víctima de Robo/Asalto") + ylab("Personas") + labs(fill = "Situación Laboral") + theme_bw() + scale_fill_manual(values = pal)
as_tibble(xtabs(~ Vic_Rob_As + Sit_Lab , data = CData_CDMX2_1))  %>% ggplot() +
geom_bar(aes(x=Vic_Rob_As, y = n, fill = Sit_Lab), stat = "identity", color = "black", position = position_dodge()) +
xlab("Número de Robos/ Asaltos") + ylab("Personas") + labs(fill = "Situación Laboral") + theme_bw() + scale_fill_manual(values = pal)
#Scatter Plot todos los datos
CData_CDMX %>% ggplot() + geom_point(aes(x = 1:5496,y = Vic_Rob_As))
#Scatter Plot todos los datos
CData_CDMX2 %>% ggplot() + geom_point(aes(x = 1:5496,y = Vic_Rob_As))
#Scatter Plot todos los datos
CData_CDMX2 %>% ggplot() + geom_point(aes(x = 1:5417,y = Vic_Rob_As))
CData_CDMX %>%
ggplot() +
geom_bar(aes(x = Vic_Rob_As))
CData_CDMX2 %>%
ggplot() +
geom_bar(aes(x = Vic_Rob_As))
CData_CDMX2 %>%
ggplot() +
geom_bar(aes(x = Vic_Rob_As) + col ="#00B8C2")
# Barplot nÃºmero de delitos
CData_CDMX2 %>%
ggplot() +
geom_bar(aes(x = Vic_Rob_As), col ="#00B8C2")
# Barplot nÃºmero de delitos
CData_CDMX2 %>%
ggplot() +
geom_bar(aes(x = Vic_Rob_As), fill ="#00B8C2")
CData_CDMX2 %>%
ggplot() +
geom_bar(aes(x = Vic_Rob_As), fill ="#00B8C2") + + theme_bw()
CData_CDMX2 %>%
ggplot() +
geom_bar(aes(x = Vic_Rob_As), fill ="#00B8C2") + theme_bw()
# Barplot nÃºmero de delitos
CData_CDMX2 %>%
ggplot() +
geom_bar(aes(x = Vic_Rob_As), fill ="#00B8C2") + theme_bw() + ylab(Personas) + xlab(Número de Robos/Asaltos)
# Barplot nÃºmero de delitos
CData_CDMX2 %>%
ggplot() +
geom_bar(aes(x = Vic_Rob_As), fill ="#00B8C2") + theme_bw() + ylab("Personas") + xlab("Número de Robos/Asaltos")
CData_CDMX3 %>%
ggplot() +
geom_bar(aes(x = Vic_Rob_As), fill ="#00B8C2") + theme_bw() + ylab("Personas") + xlab("Número de Robos/Asaltos")
CData_CDMX3_1 %>%
ggplot() +
geom_bar(aes(x = Vic_Rob_As), fill ="#00B8C2") + theme_bw() + ylab("Personas") + xlab("Víctima de Robo/Asalto")
as_tibble(xtabs(~ Vic_Rob_As + sort(Nivel_Edu) , data = CData_CDMX3_1))  %>% ggplot() +
geom_bar(aes(x=Vic_Rob_As, y = n, fill = Nivel_Edu), stat = "identity", color = "black", position = position_dodge()) +
xlab("Víctima de Robo/Asalto") + ylab("Personas") + labs(fill = "Alcaldía Segura") + theme_bw() + scale_fill_manual(values = pal)
# Sit_Lab
as_tibble(xtabs(~ Vic_Rob_As + sort(Nivel_Edu) , data = CData_CDMX3_1))
as_tibble(xtabs(~ Vic_Rob_As + sort(Nivel_Edu) , data = CData_CDMX3_1))  %>% ggplot() +
geom_bar(aes(x=Vic_Rob_As, y = n, fill = sort(Nivel_Edu)), stat = "identity", color = "black", position = position_dodge()) +
xlab("Víctima de Robo/Asalto") + ylab("Personas") + labs(fill = "Alcaldía Segura") + theme_bw() + scale_fill_manual(values = pal)
# Sit_Lab
as_tibble(xtabs(~ Vic_Rob_As + sort(Nivel_Edu) , data = CData_CDMX3_1))
as_tibble(xtabs(~ Vic_Rob_As + Nivel_Edu , data = CData_CDMX3_1))  %>% ggplot() +
geom_bar(aes(x=Vic_Rob_As, y = n, fill = Nivel_Edu), stat = "identity", color = "black", position = position_dodge()) +
xlab("Víctima de Robo/Asalto") + ylab("Personas") + labs(fill = "Alcaldía Segura") + theme_bw() + scale_fill_manual(values = pal)
